{% extends "base.html" %}
{% block title %}
  Upload Scholarship
{% endblock title %}
{% block body %}
{% include "components/navbar.html" %}
<div class="bg-white shadow-lg rounded-lg p-8 w-full max-w-4xl">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Post a New Scholarship</h2>
    <form id="scholarshipForm" method="POST" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        <input type="text" name="title" placeholder="Scholarship Title" class="w-full p-3 border border-gray-300 rounded" required>
        <input type="hidden" id="posted_by" name="posted_by" value="{{ user.id }}">
        
        <div class="relative">
            <input type="text" id="category" name="category" placeholder="Eligible Category" class="w-full p-3 border border-gray-300 rounded" required onkeyup="fetchCategories()">
            <div id="categorySuggestions" class="absolute w-full bg-white border border-gray-300 rounded hidden"></div>
        </div>
    
        <input type="number" name="amount" placeholder="Scholarship Amount" class="w-full p-3 border border-gray-300 rounded" required>
        <label class="block text-gray-700 font-medium">Last Date to Apply</label>
        <input type="date" name="last_date" class="w-full p-3 border border-gray-300 rounded" required>
        
        <label class="block text-gray-700 font-medium">Documents Required</label>
        <textarea name="documents_required" placeholder="List of documents required" class="w-full p-3 border border-gray-300 rounded" rows="3" required></textarea>
        
        <label class="block text-gray-700 font-medium">Other Requirements</label>
        <textarea name="other_requirements" placeholder="Mention any additional eligibility criteria or requirements" class="w-full p-3 border border-gray-300 rounded" rows="3"></textarea>
        
        <label class="block text-gray-700 font-medium">Upload Scholarship Poster (Optional)</label>
        <input type="file" name="poster" class="w-full p-2 border border-gray-300 rounded">
        
        <button type="submit" class="w-full p-3 bg-yellow-500 text-white font-bold rounded hover:bg-yellow-600 transition">Submit Scholarship</button>
    </form>
    
</div>
<script>
    function fetchCategories() {
    const input = document.getElementById("category");
    const suggestions = document.getElementById("categorySuggestions");

    if (input.value.length < 2) {
        suggestions.classList.add("hidden");
        return;
    }

    fetch(`/api/categories/?query=${input.value}`)
        .then(response => response.json())
        .then(data => {
            suggestions.innerHTML = "";
            data.forEach(category => {
                const div = document.createElement("div");
                div.textContent = category;
                div.classList.add("p-2", "cursor-pointer", "hover:bg-gray-200");
                div.onclick = () => {
                    input.value = category;
                    suggestions.classList.add("hidden");
                };
                suggestions.appendChild(div);
            });
            suggestions.classList.remove("hidden");
        });
}

document.getElementById("scholarshipForm").addEventListener("submit", function (event) {
    event.preventDefault();

    const formData = new FormData(this);

    fetch("/api/post-scholarship/", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("Scholarship posted successfully!");
            // window.location.reload();  // Reload after submission
            location.href = `scholarship/${data.scholarship_id}`
        } else {
            alert("Error: " + data.error);
        }
    })
    .catch(error => console.error("Error:", error));
});

</script>
{% endblock body %}